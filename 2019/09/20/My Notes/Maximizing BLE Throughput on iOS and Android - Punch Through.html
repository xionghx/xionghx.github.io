<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.2.1 (456793)"/><meta name="created" content="2019-09-24 08:17:43 +0000"/><meta name="source" content="web.clip7"/><meta name="source-application" content="webclipper.evernote"/><meta name="source-url" content="https://punchthrough.com/maximizing-ble-throughput-on-ios-and-android/"/><meta name="updated" content="2019-09-24 08:17:43 +0000"/><title>Maximizing BLE Throughput on iOS and Android - Punch Through</title></head><body>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="font:inherit;vertical-align:baseline;font-size:16px;box-sizing:inherit;"><div style="overflow:auto;font:inherit;vertical-align:baseline;line-height:1;box-sizing:inherit;overflow-wrap:break-word;text-rendering:optimizelegibility;-webkit-font-smoothing:antialiased;font-family:Verda, &quot;Sofia Pro&quot;, sans-serif;color:rgb(55, 56, 59);background:rgb(255, 255, 255);"><div style="font:inherit;vertical-align:baseline;box-sizing:inherit;"><div style="font:inherit;vertical-align:baseline;box-sizing:inherit;"><div style="font:inherit;vertical-align:baseline;box-sizing:inherit;-webkit-box-flex:0;"><div style="font:inherit;vertical-align:baseline;box-sizing:inherit;">

    
<div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;display:block;box-sizing:inherit;text-align:center;margin-bottom:48px;">
    
    <span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;display:inline-block;text-transform:uppercase;position:relative;margin-bottom:24px;">
        <a href="https://punchthrough.com/category/breakdowns/" rel="bookmark" style="margin:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;text-decoration:none;transition:all 0.25s ease-in-out 0s;display:block;background:rgb(239, 176, 0);padding:0.5rem 2rem 0.4rem;color:rgb(255, 255, 255);">Breakdowns</a>    </span>

    <h1 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:48px;line-height:1.3;font-weight:300;color:rgb(0, 173, 239);display:block;margin-bottom:32px;">Maximizing BLE Throughput on iOS and Android</h1>
    <div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;">
        <div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;line-height:1.75;">
            <div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:8px;">
                <img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/PunchThroughLogo_Primary-fist-e1561655921457-150x150.png" height="150" width="150"/>            </div>
            By: <a href="https://punchthrough.com/author/ptdprod" title="Posts by Punch Through" rel="author" style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;text-decoration:none;transition:all 0.25s ease-in-out 0s;color:rgb(239, 176, 0);">Punch Through</a>        </div>
        <span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;">April 3, 2016</span>
    </div>
</div>

    <div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;line-height:1.75;">
        <p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Still confused about how fast you can really send data over Bluetooth Low Energy?</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">It’s not just you. A google search will turn up many incomplete answers. Each OS and device <span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;"/> has it’s own restrictions, such as connection interval and number of packets per interval. For example, <strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">did you know that with iOS you can send 4 packets per interval, and that HID devices can communicate 2.6x faster?<br style="box-sizing:inherit;"/>
</strong></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;"> If you want to finally clear up how fast you can communicate over BLE with an iPhone, Android device, or Mac, read on.<br style="box-sizing:inherit;"/>
</span></p>
<hr style="box-sizing:inherit;margin-bottom:32px;"/>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;"><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;color:#ff0000;">NOTE:</span> This is Part 1 in Punch Through’s Maximizing BLE Throughput blog series. Due to improvements to the Bluetooth Specification, hardware and mobile OSes, some aspects of this blog may be outdated. Here are links to our more recent posts in this series:</strong></p>
<ul style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none;box-sizing:inherit;margin-bottom:32px;margin-left:35px;">
<li style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;list-style-type:disc;margin-bottom:16px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Part 2: <a href="https://punchthrough.com/pt-blog-post/maximizing-ble-throughput-part-2-use-larger-att-mtu" style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;color:rgb(0, 173, 239);text-decoration:none;transition:all 0.25s ease-in-out 0s;">Maximizing BLE Throughput: Use a Larger ATT MTU</a></strong></li>
<li style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;list-style-type:disc;margin-bottom:16px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Part 3: <a href="https://punchthrough.com/pt-blog-post/maximizing-ble-throughput-part-3-data-length-extension-dle/" style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;color:rgb(0, 173, 239);text-decoration:none;transition:all 0.25s ease-in-out 0s;">Maximizing BLE Throughput: Data Length Extension (DLE)</a></strong></li>
</ul>
<hr style="box-sizing:inherit;margin-bottom:32px;"/>
<h2 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:38px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Let’s start with the obvious wrong.</h2>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">1 Mega bits per second is just wrong</strong>. That is the modulation frequency used to transfer a given BLE packet. Assuming this to be the maximum throughput is simply ignoring the communication protocol completely. There are many elements that affect/limit BLE’s throughput such as:</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">– Maximum packet length<br style="box-sizing:inherit;"/>
– Time delays in between packets<br style="box-sizing:inherit;"/>
– Overhead bytes in a packet such as packet length, data integrity check, and general packet information.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">So, how about 50% to 75% of 1mbps?  That is still 31.25 to 62.5 kB per second. That is still really good, so is it possible? Optimistically, maybe. Let’s talk how that is a maybe.</p>
<h1 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;">The Science of BLE Throughput</h1>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">A BLE connection consists of only two devices, where one is called central (like master) and the other called peripheral (like slave). Each side communicates with the other on a given period called<strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;"> Connection Interval</strong> (minimum of 7.5 milliseconds and increases in steps of 1.25 milliseconds). Each instance of communication between two devices is called a <strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Communication Event</strong>.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/min-connection-interval.png" height="236" width="647"/><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;">A communication event starts by the central (master) transmitting a packet while the peripheral device is in receive mode. If the peripheral received the packet from central successfully, the peripheral will subsequently transmit its packet while the central is in receive mode. By default, the central and peripheral each will transmit a packet even if they have nothing to send, this is often called </span><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;background-color:transparent;">Empty Link Layer PD.</strong></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/SinglePacketPerconnectionInterval-768x173.jpg" height="173" width="768"/></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">For the cases when the central and peripheral have queued up messages, they can “ask” or “alert” the other side that they have more data to send before ending the connection event. This can result in multiple packets being exchanged during one interval. The connection event continues until a packet either fails to be received correctly, the sender is satisfied with ending the connection event, or, in a very unlikely scenario, the end of the interval has been reached.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/MultiplePacketPerConnectionInterval-768x153.jpg" height="153" width="768"/></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">The note to be learned is that in a connection event you can exchange more than two packets, which increases the throughput tremendously. It is important to know that maximum number of packets per connection event is dependent on the BLE stack/chipsets and is limited to 4 packets per connection event with iOS, and 6 packets per connection event in Android.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/packets-per-interval.png" height="236" width="647"/></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">The equation for number of BLE packets in a given second boils down to the following:</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/PacketsPerSecond.png" height="39" width="630"/></p>
<h2 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:38px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;"><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;">General BLE Data Throughput Formula</span></h2>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;">Remember, we stated that a given data throughput number in BLE is only valid when posted with context. Well, this context is the following three important elements:</span></p>
<ul style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;list-style:none;box-sizing:inherit;margin-bottom:32px;margin-left:35px;">
<li style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;list-style-type:disc;margin-bottom:16px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Connection Interval</strong> – How often the devices talk.</li>
<li style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;list-style-type:disc;margin-bottom:16px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Number of Packets per Connection Interval</strong> – How many packets exchanged when they do talk.</li>
<li style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;list-style-type:disc;margin-bottom:16px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Packet Length</strong> – Length of Application Data in a BLE packet.</li>
</ul>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">The theoretical maximum application data throughput in BLE can be described as the following formula:</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/ThroughPutTooGeneral.png" height="17" width="416"/></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Filling in the previous formula for Packets Per Second, we get the following:</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/ThroughputGeneral.jpg" height="42" width="712"/></p>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Data Per Packet</h3>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">In a forthcoming blog post, we will go in depth about the BLE packet structure and the possible sizes of application data in a packet, but for now it is safe to say that a BLE packet contains a <strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">maximum of 20 bytes of application data</strong> for BLE v4.0 and v4.1 (v4.2 includes a data packet length extension, but this is not used in iOS or Android yet). Remember the actual BLE packet is longer in size but naturally it includes segments for many important purposes such as CRC and headers for different layers.</p>
<h2 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:38px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Solving the Throughput Formula</h2>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">If we remember anything from high school or middle school math, and that is dependent on which country you went to school, we learned that we cannot solve an equation with three unknowns, and that is the moral of the BLE throughput story. BLE throughput requires context for it to be meaningful and the context starts by determining the connection interval (the smaller generally gets you faster throughput, though there are some interesting exceptions) and the number of packets in a connection event. For simplicity, let’s assume number of application data bytes per BLE packet is a constant 20 bytes.</p>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">For iOS 9.2 and iPhone 6, The minimum connection interval is 30 milliseconds unless you support HID over GATT Profile which allows for connections down to 11.25 milliseconds.</h3>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">For Android devices, the minimum connection interval is 7.5 milliseconds.</h3>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">The “Bluetooth Accessory Design Guidelines for Apple Products” does mention a minimum interval of 20ms, but this is not seen in practice. In our experience, we have observed 8 packets (4 in one direction) per connection event, which gives us an ideal throughput of</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;"><em style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-style:italic;">BLE Data Throughput for a Single Direction with iPhone 6 = (1000 mSecs) * 20 * ( 4 ) / (30 mSecs) = 2,667.66 Bytes per second.</em><br style="box-sizing:inherit;"/>
</span></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">and if HID over GATT Profile is supported:</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><em style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-style:italic;">Throughput is then increased to = (1000 mSecs) * 20 * 4 / (11.25 mSecs) = 7,111.11 Bytes per second</em></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Hint: You have the ability to increase your length of application data in a packet to iPhone 6 by three bytes which can increase your throughput by 15%. In future blogposts, we will discuss this.</p>
<h2 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:38px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Achieving Faster Throughput</h2>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Simple answer is sometimes you are just limited by the constraints on the three parameters of the other BLE device even if your BLE device can support lower connection intervals or send more than 4 packets per connection event.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;">For example, let’s take the same peripheral device that we used to connect to iPhone 6 and connect to a different client (hardware) at a connection interval of 10mSecs and up to 12 packets (6 in one direction) per connection event. This will increase the ideal maximum as follows:</span></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><em style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-style:italic;">Throughput for a Single Direction = (1000mSecs) * 20 * (6) / (10 mSecs) = 12,000 Bytes per second. </em></p>
<h2 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:38px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Common Practices and Obstacles</h2>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">In order to achieve the theoretical maximum throughput values, the system and the design of the devices must seek to use all the available time slots in a connection event to transfer a given data payload.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">For example, if you perform a loopback for the data, you may find that the throughput measured on the application layer is well below the maximum value. This could be the result of many factors, such as:</p>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Connection Interval</h3>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">As a peripheral/slave, you can request for the connection interval to be lowered (if applicable) using a Connection Parameters Update Request message. Some Android devices may connect at slower connection intervals initially before lowering the connection interval when requested.</p>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Interference</h3>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">If interference exists and causes the first packet of the connection event to not be received correctly, the connection event is subsequently ended and the data will then have to be resent in the next connection event. Where as if the last packet of the connection even is interfered with, the repercussion is much less.</p>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Importance of Number of Packets per Connection Event and Corner Cases</h3>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Let’s assume the application’s loopback payload to be 100 bytes long and the maximum number of packets per connection event is 4. This results in two connection events to transfer 100 bytes (ideally) in one direction. And it takes two connection events to transfer the data back.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Let’s increase the application loopback payload to 140 bytes, which is segmented into 7 packets. That still results in two connection events to transfer the data.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Interestingly enough, the loopback application will yield similar throughput numbers for payload sizes of 100 and 140 bytes. It is import for the Bluetooth devices to use every time slot available in a connection interval to increase the data transfer.</p>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Latency between the Application Layer and Physical layer</h3>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">This is the time between when the application layer submits a packet to be transferred to the time that the packet is sent. In many platforms such as smart phones, this is difficult to optimize as the smart-phone may introduce a latency that cannot be removed; however, in most of the embedded systems, the developer should seek to find ways to remove this delay, whether it is by processing the packets faster or methods suggested by the BLE Stack/Chipset provider.</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">For example, in the loopback throughput measurement if a device receives 160 bytes of data in two connection events but it fails to process the payload quickly for the next connection event, then you will be penalized with a connection event that has gone untapped.</p>
<h3 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:28px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Proper Methods to Use When Transferring Application Data</h3>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Transferring data to and from the GATT can be achieved in multiple ways. In order to achieve higher throughput, the method that allows for more than one packet in a connection event needs to be selected. Use <strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Write Command </strong>instead of <strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Write Request </strong>or<strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;"> Blob Write </strong>when sending data from GATT Client to GATT Server, Use <strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Notification </strong>instead of <strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Indication </strong>when sending data from GATT Server to GATT Client. We will discuss the pros and cons of the different GATT data transfer methods in a separate blog post.</p>
<h2 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:38px;color:rgb(0, 173, 239);display:block;margin-bottom:16px;">Maximum Throughput with Smartphones, Laptops</h2>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">Here are maximum throughput numbers for a given set of popular smart phones and laptops:</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><img src="Maximizing%20BLE%20Throughput%20on%20iOS%20and%20Android%20-%20Punch%20Through.resources/total-throughput.png" height="236" width="647"/></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">iPhone 6,6+,6S,6S+</strong>:<br style="box-sizing:inherit;"/>
Normal Connection Interval of 30mSecs: 2,667 bytes/sec<br style="box-sizing:inherit;"/>
Connection Interval for HID Over GATT is Present 11.25mSecs: 7,111 bytes/sec</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">MacBook Pro – OS X</strong> (Varies on models):<br style="box-sizing:inherit;"/>
Maximum Connection Interval range of (11.25 – 15mSecs): 7,111 bytes/sec – 5334 bytes/sec</p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Android </strong><br style="box-sizing:inherit;"/>
<span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;">Nexus 4: </strong></span>Minimum Connection Interval of 7.5 mSecs – Packets per connection Interval: 6 – Throughput: 16,000 Bytes/Sec<span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;"><strong style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-weight:bold;"><br style="box-sizing:inherit;"/>
Nexus 6P: </strong></span><span style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;background-color:transparent;">Minimum Connection Interval of 7.5 mSecs – Packets per connection Interval: 6 – Throughput: 16,000 Bytes/Sec</span></p>
<p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:32px;">This is part 1 of a 2 part series. You can find part 2 here: <a title="https://punchthrough.com/blog/posts/maximizing-ble-throughput-part-2-use-larger-att-mtu" href="https://punchthrough.com/blog/posts/maximizing-ble-throughput-part-2-use-larger-att-mtu" style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;color:rgb(0, 173, 239);text-decoration:none;transition:all 0.25s ease-in-out 0s;">Maximizing BLE Throughput Part 2 – Choosing a larger MTU</a>.</p>


<div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;text-align:center;position:relative;padding-top:30px;">
                        <div style="margin:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;display:flex;-webkit-box-pack:justify;justify-content:space-between;margin-bottom:32px;position:relative;background:rgb(14, 57, 87);color:rgb(255, 255, 255);text-align:left;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-flow:column;-webkit-box-align:start;align-items:flex-start;padding:3rem 4rem 3rem 2rem;">
                        <div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;margin-bottom:16px;">
                            <h2 style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;font-size:38px;line-height:1.3;font-weight:300;color:#EFB000;display:block;margin-bottom:16px;">
                                Get awesome, valuable content straight to your inbox                            </h2>
                        </div>
                        <div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;line-height:1.75;margin-bottom:0px;">
                            <p style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;display:block;margin-bottom:16px;">Join the conversation with 40,000+ folks who get everything from our latest Bluetooth breakdowns to sharing stories from engineers and leaders around the world.</p>
<div style="font:inherit;vertical-align:baseline;background:none;border-radius:0px;float:none;font-size:100%;height:auto;letter-spacing:normal;list-style:none;outline:none;position:static;text-decoration:none;text-indent:0px;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;box-shadow:none;margin:0px;padding:0px;border:0px none;box-sizing:border-box;margin-bottom:0px;"><div style="margin:0px;padding:0px;border:0px;font:inherit;vertical-align:baseline;box-sizing:inherit;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row wrap;-webkit-box-align:start;align-items:flex-start;-webkit-box-pack:start;justify-content:flex-start;"><div style="font:inherit;vertical-align:baseline;background:none;border-radius:0px;float:none;font-size:100%;height:auto;letter-spacing:normal;list-style:none;outline:none;position:static;text-decoration:none;text-indent:0px;text-shadow:none;text-transform:none;visibility:visible;overflow:visible;box-shadow:none;margin:0px;padding:0px;border:0px none;box-sizing:border-box;max-width:65%;width:100%;"><div style="font:inherit;vertical-align:baseline;background:none;border-radius:0px;float:none;font-size:100%;height:auto;letter-spacing:normal;list-style:none;outline:none;position:static;text-decoration:none;text-indent:0px;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;box-shadow:none;margin:0px;border:0px none;box-sizing:border-box;clear:both;padding:10px 0px;padding-right:16px;"><span style="font:inherit;border-radius:0px;letter-spacing:normal;list-style:none;outline:none;text-decoration:none;text-indent:0px;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;box-shadow:none;border:0px;vertical-align:middle;box-sizing:border-box;background:none;height:auto;font-weight:700;line-height:1.3;margin:0px 0px 4px;padding:0px;float:none;font-size:16px;display:block;left:-99999px;position:absolute;">Email <span style="font:inherit;vertical-align:baseline;background:none;border-radius:0px;float:none;font-size:100%;height:auto;letter-spacing:normal;list-style:none;outline:none;position:static;text-decoration:none;text-indent:0px;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;box-shadow:none;margin:0px;padding:0px;border:0px none;box-sizing:border-box;color:rgb(255, 0, 0);font-weight:400;">*</span></span></div></div><div style="font:inherit;vertical-align:baseline;background:none;border-radius:0px;float:none;font-size:100%;height:auto;letter-spacing:normal;list-style:none;outline:none;text-decoration:none;text-indent:0px;text-shadow:none;text-transform:none;width:auto;visibility:visible;overflow:visible;box-shadow:none;margin:0px;border:0px none;box-sizing:border-box;clear:both;padding:10px 0px 0px;position:relative;"/></div></div>                          </div>
                    <span style="font:inherit;color:rgb(255, 255, 255);text-align:left;z-index:3;position:absolute;bottom:0px;right:0px;width:0px;height:0px;border-top:5.625rem solid transparent;border-right:4.0625rem solid rgb(255, 255, 255);"/></div>
                    </div>

    </div>

</div></div></div></div></div></div></div>
</div>
</body></html>